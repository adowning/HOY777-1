(function(c,e){typeof exports=="object"&&typeof module!="undefined"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(c=typeof globalThis!="undefined"?globalThis:c||self,e(c.VueProgressiveImage={},c.Vue))})(this,function(c,e){"use strict";var O="";const I="success",S="error",E=t=>{const o=new Image,r=e.ref(0),a=e.ref(0),l=e.computed(()=>r.value?a.value/r.value:.5625),n=setInterval(()=>{o&&o.width&&(clearInterval(n),r.value=o.width,a.value=o.height)},10),i=d=>{const s=document.createElement("canvas");s.width=1,s.height=1,s.setAttribute("hidden",!0),document.body.appendChild(s),s.getContext("2d").drawImage(d,0,0),document.body.removeChild(s)};return{width:r,height:a,aspectRatio:l,loadImage:()=>{const d=e.isRef(t)?t.value:t,s=d.src;return o.src=s,o.complete?Promise.resolve():new Promise((h,g)=>{o.onload=()=>{i(d),e.nextTick(h)},o.onerror=g})}}},b=t=>{const o=e.ref(!1),r={threshold:.2},a=new IntersectionObserver(n=>{n[0].isIntersecting&&(o.value=!0,a.disconnect())},r),l=n=>{const i=e.watch(o,m=>{m&&(e.nextTick().then(n),i())},{immediate:!0})};return e.onMounted(()=>{const n=e.isRef(t)?t.value:t;a.observe(n)}),e.onUnmounted(()=>{a.disconnect()}),{watchIntersectionOnce:l,isIntersected:o}},k=["src","alt","title"],C=["loading","src"],R={key:1,class:"v-progressive-image-slot-default"},u={props:{src:String,placeholderSrc:String,fallbackSrc:String,alt:String,title:String,customClass:String,blur:[Number,String],lazyPlaceholder:{type:Boolean,default:!1},delay:{type:[Number,String],default:0},objectCover:{type:Boolean,default:!1}},emits:[I,S],setup(t,{emit:o}){const r=t,a=e.ref(null),l=e.ref(null),n=e.ref(!1),i=e.ref(!1),{isIntersected:m,watchIntersectionOnce:d}=b(a),{loadImage:s,aspectRatio:h,width:g}=E(l),p=e.computed(()=>!n.value),T=e.computed(()=>({paddingBottom:`${h.value*100}%`})),A=e.computed(()=>{if(!(r.objectCover||g.value===0))return{maxWidth:`${g.value}px`}}),N=e.computed(()=>[r.customClass,{"v-progressive-image-object-cover":r.objectCover,"v-progressive-image-loading":p.value}]),w=()=>{s().then(()=>{setTimeout(()=>{n.value=!0,o(I)},r.delay*1)}).catch(f=>{n.value=!0,i.value=!0,o(S,f)})};return e.onMounted(()=>{r.placeholderSrc&&r.blur&&document.documentElement.style.setProperty("--progressive-image-blur",`${r.blur*1}px`),r.src&&d(w)}),(f,P)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"rootRef",ref:a,class:e.normalizeClass(["v-progressive-image",e.unref(N)]),style:e.normalizeStyle(e.unref(A))},[e.createElementVNode("div",{style:e.normalizeStyle(e.unref(T))},[e.createVNode(e.Transition,{css:!t.placeholderSrc,name:"v-progressive-image-main-fade",appear:""},{default:e.withCtx(()=>[e.unref(m)?e.withDirectives((e.openBlock(),e.createElementBlock("img",{key:0,ref_key:"imageRef",ref:l,class:"v-progressive-image-main",src:i.value?t.fallbackSrc:t.src,alt:t.alt,title:t.title},null,8,k)),[[e.vShow,n.value]]):e.createCommentVNode("",!0)]),_:1},8,["css"]),t.placeholderSrc?(e.openBlock(),e.createBlock(e.Transition,{key:0,name:"v-progressive-image-placeholder-fade",appear:""},{default:e.withCtx(()=>[e.unref(p)?(e.openBlock(),e.createElementBlock("img",{key:0,class:"v-progressive-image-placeholder",loading:t.lazyPlaceholder?"lazy":"eager",src:t.placeholderSrc},null,8,C)):e.createCommentVNode("",!0)]),_:1})):e.createCommentVNode("",!0),f.$slots.default?(e.openBlock(),e.createElementBlock("div",R,[e.renderSlot(f.$slots,"default",{isLoading:e.unref(p)})])):e.createCommentVNode("",!0)],4)],6))}},y=(t,o={})=>{Object.keys(o).forEach(r=>{u.props[r].default=o[r]}),t.component("ProgressiveImage",u)};c.ProgressiveImage=u,c.default=y,c.install=y,Object.defineProperties(c,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
